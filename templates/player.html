{% extends "base.html" %}
{% block title %}Profile | Donz Hockey{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <a href="/records" class="inline-flex items-center text-gray-500 hover:text-black font-bold mb-6 transition-colors">‚Üê Back to Records</a>

    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-6">
        <div class="p-8 text-center bg-black text-white border-b-4 border-yellow-400">
            <div class="w-24 h-24 bg-yellow-400 text-black rounded-full flex items-center justify-center text-4xl font-black mx-auto mb-4 shadow-xl border-4 border-white">
                {{ player_name[0] | upper }}
            </div>
            <h1 class="text-3xl font-black mb-1 uppercase italic">{{ player_name }}</h1>
            <p class="text-gray-400 text-sm font-bold tracking-widest uppercase">Player Profile</p>
        </div>
        
        <div class="p-6 text-center border-b border-gray-100">
            <p class="text-gray-400 uppercase text-xs font-black tracking-widest">Total Practices</p>
            <p id="total-count" class="text-5xl font-black text-black mt-2">...</p>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
        <div class="p-4 bg-gray-50 border-b border-gray-200">
            <h2 class="font-bold text-gray-900 uppercase">Attendance Log</h2>
        </div>
        <ul id="date-list" class="divide-y divide-gray-100">
            <li class="p-6 text-center text-gray-500">Loading details...</li>
        </ul>
    </div>
</div>

<script>
    const playerName = "{{ player_name }}";
    async function loadDetails() {
        try {
            const res = await fetch(`/api/player-details?name=${encodeURIComponent(playerName)}`);
            const data = await res.json();
            if (data.error) throw new Error(data.error);

            document.getElementById('total-count').innerText = data.total;
            const list = document.getElementById('date-list');
            list.innerHTML = '';

            if (data.dates.length === 0) {
                list.innerHTML = '<li class="p-6 text-center text-gray-400">No attendance found.</li>';
                return;
            }

            data.dates.forEach(date => {
                const li = document.createElement('li');
                li.className = "p-4 flex items-center justify-between hover:bg-yellow-50 transition";
                const dateObj = new Date(date);
                const displayDate = isNaN(dateObj) ? date : dateObj.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                li.innerHTML = `
                    <span class="font-bold text-gray-800">${displayDate}</span>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-black bg-yellow-400 text-black uppercase tracking-wide">Present</span>
                `;
                list.appendChild(li);
            });
        } catch (err) { document.getElementById('date-list').innerHTML = `<li class="p-6 text-center text-red-500">${err.message}</li>`; }
    }
    loadDetails();
</script>
{% endblock %}